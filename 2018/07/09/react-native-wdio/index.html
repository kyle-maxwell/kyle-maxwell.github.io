<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>React Native Application UI testing using WebDriverIO and Appium — GoDaddy Engineering Blog</title>
  <meta name="description" content="Information from our engineering team about the technology and tools we use to create software which empowers small businesses around the world to build and market their digital identities.
">

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link rel="stylesheet" href="/engineering/assets/css/main.css">

  <meta name="theme-color" content="#4095e8">
  <meta name="msapplication-TileColor" content="#4095e8">
  <link rel="apple-touch-icon" sizes="180x180" href="/engineering/assets/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/engineering/assets/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/engineering/assets/images/favicon-16x16.png">
  <link rel="manifest" href="/engineering/site.webmanifest">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/engineering/feed.xml" title="GoDaddy Engineering Blog" />

  
  <link rel="canonical" href="http://localhost:4000/2018/07/09/react-native-wdio/">
  

  <meta property="og:locale" content="en_US">
  <meta property="og:site_name" content="GoDaddy Engineering Blog">
  <meta property="og:url" content="http://localhost:4000/2018/07/09/react-native-wdio/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@GodaddyOSS">

  
  <meta property="og:image" content="http://localhost:4000/assets/images/react-native-wdio/cover-wdio.png">
  

  
  <meta property="og:title" content="React Native Application UI testing using WebDriverIO and Appium — GoDaddy Engineering Blog">
  

  
  <meta property="og:description" content="We recently adopted WebDriverIO based UI testing for our React Native application. Benefits of using WebDriverIO include allowing us to write UI tests just as we wrote tests for the web. WebDriverIO configuration allows us to plugin Sauce Labs Emulators or Real Devices for cloud-based testing.">
  

  <link rel="preload" href="//img1.wsimg.com/ux/fonts/boing/1.0/Boing-Bold.woff2" as="font" type="font/woff2" crossOrigin />
  <style>
  @font-face {
    font-family: Boing-Bold;
    src: url(//img1.wsimg.com/ux/fonts/boing/1.0/Boing-Bold.woff2) format("woff2"), url(//img1.wsimg.com/ux/fonts/boing/1.0/Boing-Bold.woff) format("woff");
    font-display: swap;
  }
  </style>
  <link rel="preload" href="//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-bold.woff2" as="font" type="font/woff2" crossOrigin />
  <style>
  @font-face {
    font-family: gdsherpa;
    src: url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-bold.woff2) format("woff2"), url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-bold.woff) format("woff");
    font-weight: 700;
    font-display: swap;
  }
  </style>
  <link rel="preload" href="//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-regular.woff2" as="font" type="font/woff2" crossOrigin />
  <style>
  @font-face {
    font-family: gdsherpa;
    src: url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-regular.woff2) format("woff2"), url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-regular.woff) format("woff");
    font-display: swap;
  }
  </style>
</head>

  <body class="layout--post page--react-native-wdio">
    <nav class="navbar utility-bar navbar-dark bg-theme-grey-dark px-3 py-0">
  <a class="navbar-brand pt-1 pb-0" href="https://www.godaddy.com">
    <svg class="logo-mark logo-mark-white" height="18" viewBox="0 0 367.7 78.1" xmlns="http://www.w3.org/2000/svg"><path class="logo-mark-color" d="M95.3 38.6c0-4.6-3.6-8.4-8.3-8.4-4.6 0-8.3 3.8-8.3 8.4s3.6 8.3 8.3 8.3 8.3-3.7 8.3-8.3m14.4.1c0 11.9-10.1 21.4-22.6 21.4-12.6 0-22.6-9.5-22.6-21.4 0-12 10.1-21.6 22.6-21.6 12.5-.1 22.6 9.6 22.6 21.6M154.8 30c0-8-5.6-15-13.9-15h-11.5v30.3h11.5c8.3 0 13.9-7.3 13.9-15.3m15.5 0c0 17.1-12.1 28.8-29.1 28.8h-24.6c-1.2 0-2.1-.9-2.1-2V3.4c0-1.1.9-2 2.1-2h24.6c17.1.1 29.1 11.5 29.1 28.6M194.4 46.9c4.6 0 8.3-3.8 8.3-8.4s-3.6-8.4-8.3-8.4c-4.6 0-8.3 3.8-8.3 8.4 0 4.7 3.7 8.4 8.3 8.4M192.2 17c4.9 0 8.8 1.8 10.5 4.3v-1.2c0-1.1.9-1.9 1.9-1.9H215c1.1 0 1.9.8 1.9 1.9v36.8c0 1.1-.8 1.9-1.9 1.9h-10.3c-1.1 0-1.9-.8-1.9-1.9v-1.2c-1.7 2.5-5.7 4.3-10.6 4.3-10.4 0-20.4-8.3-20.4-21.6s10-21.4 20.4-21.4M241.4 46.9c4.6 0 8.3-3.8 8.3-8.4s-3.6-8.4-8.3-8.4c-4.6 0-8.3 3.8-8.3 8.4 0 4.7 3.7 8.4 8.3 8.4M238.9 17c5 0 8.9 1.9 10.7 4.1V3.4c0-1.1.9-1.9 1.9-1.9H262c1.1 0 1.9.8 1.9 1.9V57c0 1.1-.8 1.9-1.9 1.9h-10.3c-1.1 0-1.9-.8-1.9-1.9v-1.2c-2.1 2.5-5.7 4.3-10.6 4.3-10.4 0-20.4-8.3-20.4-21.6S228.7 17 238.9 17M288.4 46.9c4.6 0 8.3-3.8 8.3-8.4s-3.6-8.4-8.3-8.4c-4.6 0-8.3 3.8-8.3 8.4.1 4.7 3.7 8.4 8.3 8.4M286 17c5 0 8.9 1.9 10.7 4.1V3.4c0-1.1.9-1.9 1.9-1.9H309c1.1 0 1.9.8 1.9 1.9V57c0 1.1-.8 1.9-1.9 1.9h-10.3c-1.1 0-1.9-.8-1.9-1.9v-1.2c-2.1 2.5-5.7 4.3-10.6 4.3-10.4 0-20.4-8.3-20.4-21.6S275.7 17 286 17M345.5 64.7c-2.6 8.6-8.6 13.4-18 13.4-5.1 0-10.1-1.7-13.3-4.5-.5-.5-.8-1.1-.8-1.7 0-.5.2-1.1.7-1.7l3.9-5.9c.6-.8 1.5-.9 1.7-.9.9 0 1.3.2 2.1.8 1.2.8 2.9 1.8 4.8 1.8 1.6 0 3.7-.7 4.5-3.1l1.3-4.1H326c-1.3 0-2.1-.9-2.5-2L313 21.5c-.2-.9-.3-1.4-.3-1.7 0-.8.6-1.5 1.7-1.5h12.4c1.1 0 1.7 1 2 2l6.9 25.4h.5l5.5-25.4c.2-1 .9-2 2-2h12.6c1.2 0 1.7.7 1.7 1.5 0 .3-.1.8-.3 1.7l-12.2 43.2M49.7 50.9c-5 6.9-13.2 9.2-20.5 9.2C12.4 60.1 0 47.6 0 30.2.1 13.5 13.5.2 31 .2c13 0 23.4 5.5 28.1 16 .6 1.2 1 3.2-2.5 3.8l-9.2 1.6c-2.1.4-3.3-1-3.7-1.6-2.7-3.7-7.1-6.2-12.4-6.2-9.2 0-15.7 7-15.7 16.3 0 10.3 7.4 16.3 15.5 16.3 5.4 0 9.8-2 12.7-5.8h-8.1c-1.2 0-2.1-.9-2.1-2v-7.7c0-1.1.9-2 2.1-2h24.7c1.2 0 2.1.9 2.1 2v25.9c0 1.1-.9 2-2.1 2h-8.6c-1.2 0-2.1-.9-2.1-2v-5.9M359.8 0c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14.4c-3.5 0-6.4-2.9-6.4-6.4s2.9-6.4 6.4-6.4 6.4 2.9 6.4 6.4-2.9 6.4-6.4 6.4z"></path><path class="logo-mark-color" d="M361.4 6.5c0-.4-.1-.7-.4-.8-.2-.2-.6-.4-.9-.4h-1.4v2.3h1.4c.4 0 .7-.1.9-.4.2-.2.4-.4.4-.7zm-3.1 5.9h-1.5c-.1 0-.1 0-.2-.1 0-.1-.1-.1-.1-.2V3.8c0-.1 0-.1.1-.2.1 0 .1-.1.2-.1h3.3c1.1 0 1.9.2 2.5.8s.9 1.3.9 2.1c0 .6-.1 1.1-.5 1.5-.4.5-.7.8-1.2 1.1l1.9 2.9c.1.1.1.2 0 .4 0 .1-.1.1-.2.1H362c-.1 0-.2 0-.4-.1-.1 0-.1-.1-.2-.2l-1.6-2.7h-1.2V12c0 .1 0 .1-.1.2s-.1.2-.2.2z"></path></svg>
    &nbsp;
  </a>
</nav>

<nav class="navbar navbar-top navbar-expand-md navbar-light bg-white">
  <a class="navbar-brand font-weight-bold" href="http://localhost:4000/engineering/" title="GoDaddy Engineering">
    GoDaddy Engineering
  </a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topnav" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="topnav">
    <ul class="navbar-nav ml-auto">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="http://localhost:4000/engineering/featured-projects/" title="Featured Projects">
          Featured Projects
        </a>
      </li>
      
      
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="http://localhost:4000/engineering/blog-posts/" title="Blog Posts">
          Blog Posts
        </a>
      </li>
      
      
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="http://localhost:4000/engineering/code-of-conduct/" title="Code of Conduct">
          Code of Conduct
        </a>
      </li>
      
      
      <li class="nav-item">
        <a class="nav-link btn btn-primary text-white font-weight-bold px-3" href="https://careers.godaddy.com/?source=APPLICANT_SOURCE-3-118&utm_source=godaddy-oss" title="Work at GoDaddy">
          Join us!
        </a>
      </li
    </ul>
  </div>
</nav>





<div class="container text-line-height-2x pt-3">
  <h1 class="mb-3 text-line-height-1-5-em">
    React Native Application UI testing using WebDriverIO and Appium
  </h1>

  <h2 id="motivation">Motivation:</h2>

<p>We want to automate the validation of our user experiences in order to consistently maintain a high level of quality.</p>

<p>The Mobile App team I work on utilizes native code for parts of our application, yet, most of the user interfaces are written using React Native and JavaScript. Given that most of the UI is written in JavaScript, we wanted to use a similar tech stack for the automation and validation of our user experiences (also known as functional tests) on Android and iOS platforms.</p>

<p>Although, testing frameworks like Espresso, Robotium, XCTest are currently in use by other teams at Godaddy, we needed the ability to write cross-platform UI tests for mobile platforms in Javascript and these frameworks don’t support our needs there.</p>

<p>We looked into Selenium-based <a href="https://appium.io/">Appium</a>, as that is the most popular test automation framework for both native and hybrid mobile applications which supports writing tests in JavaScript. Appium documentation suggests <a href="https://github.com/admc/wd">WD</a> (a node.js client for Webdriver/Selenium) as the official Appium client for JavaScript. We found a few shortcomings with the WD library, such as: the async nature of the framework made tests complicated and full JSONWire protocol is <a href="https://github.com/admc/wd#working-with-mobile-device-emulator">not supported</a>, which is necessary for running test commands on native.</p>

<p>Another option we came across was <a href="http://webdriver.io">WebDriverIO</a>, a Node.js implementation of the WebDriver Protocol, which has full JSONWire protocol commands implemented and also supports special bindings for Appium. The advantage of WebDriverIO is that you don’t need to care about how to handle a Promise to avoid race conditions and it takes away all the cumbersome setup work and manages the Selenium session for you, which is awesome.</p>

<p>This gives us the possibility to write clean code without the need to resolve Promises which alleviates the overhead of needlessly accommodating tests running asynchronously which has been a common source of mistakes. WebDriverIO also helps us write clean UI tests using <a href="http://webdriver.io/guide/testrunner/pageobjects.html">PageObjects</a> design pattern.</p>

<p>In order to help make this process easier for you to implement WebDriverIO for mobile functional tests, let’s explore how we accomplished the following:</p>

<ol>
  <li><a href="#write-ui-tests-running-locally-using-webdriverio-and-emulators">Write UI tests running locally using WebDriverIO and emulators</a></li>
  <li><a href="#running-tests-on-emulators-using-a-cloud-based-service-sauce-labs">Running tests on emulators using a cloud-based service: Sauce Labs</a></li>
  <li><a href="#running-tests-on-real-devices-using-a-cloud-based-service">Running tests on real devices using a cloud-based service</a></li>
  <li><a href="#making-test-results-consistent-and-predictable">Making test results consistent and predictable</a></li>
</ol>

<h2 id="write-ui-tests-running-locally-using-webdriverio-and-emulators">Write UI tests running locally using WebDriverIO and emulators</h2>

<p>In your React Native project’s directory, install WebDriverIO and create a basic WebDriverIO config.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">npm install webdriverio -g
wdio config
</span></code></pre></div></div>

<p><img src="/engineering/assets/images/react-native-wdio/wdio-config.png" alt="Screenshot showing wdio config" /></p>

<p>Follow the prompts to create a base WebDriverIO configuration as shown in the above picture.</p>

<p>For now, set the base URL to the default value: http://localhost; we will remove it in the later steps. Once done, let WebDriverIO install all the needed packages.</p>

<p>When finished, the generated WebDriverIO config can be found in the <code class="highlighter-rouge">wdio.conf</code> file at the root of the project; here is an example of what it should contain:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">specs</span><span class="p">:</span> <span class="p">[</span>
    <span class="s1">'./test/specs/**/ *.js'</span>
  <span class="p">],</span>
  <span class="na">exclude</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">maxInstances</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="na">capabilities</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">maxInstances</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="na">browserName</span><span class="p">:</span> <span class="s1">'firefox'</span>
  <span class="p">}],</span>
  <span class="na">sync</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">logLevel</span><span class="p">:</span> <span class="s1">'verbose'</span><span class="p">,</span>
  <span class="na">coloredLogs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">deprecationWarnings</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">bail</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">screenshotPath</span><span class="p">:</span> <span class="s1">'./errorShots/'</span><span class="p">,</span>
  <span class="na">baseUrl</span><span class="p">:</span> <span class="s1">'http://localhost'</span><span class="p">,</span>
  <span class="na">waitforTimeout</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
  <span class="na">connectionRetryTimeout</span><span class="p">:</span> <span class="mi">90000</span><span class="p">,</span>
  <span class="na">connectionRetryCount</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="na">framework</span><span class="p">:</span> <span class="s1">'jasmine'</span><span class="p">,</span>
  <span class="na">jasmineNodeOpts</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">defaultTimeoutInterval</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="na">expectationResultHandler</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">passed</span><span class="p">,</span> <span class="nx">assertion</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">wdio config</code> configures Jasmine as the default test runner, but, you can change it by following the documentation at <a href="http://webdriver.io/guide/testrunner/frameworks.html">WebDriverIO - Test Runner Frameworks</a>. The initial configuration doesn’t have what we need to start running mobile UI tests yet, so, let’s start tweaking it.</p>

<p>WebDriverIO supports multiple services of which Appium is a test automation framework used with mobile applications. <a href="http://webdriver.io/guide/services/appium.html">WebDriverIO’s Appium service</a> lets you automatically run an Appium server in the background, which passes on the UI test commands to the mobile emulator.</p>

<p>Now that we have a WebDriverIO configuration, let’s set it up to work with Appium.</p>

<p><strong>Step 1:</strong> Install Appium and wdio-appium-service:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">npm install appium --save-dev
npm install wdio-appium-service --save-dev
</span></code></pre></div></div>

<p><strong>Step 2:</strong> Provide capabilities based on the platform you would like to run tests on. Capabilities tell an Appium service what environment and/or devices to run the tests in. Documents here provide insight into capabilities that are supported by Appium: <a href="https://appium.io/docs/en/writing-running-appium/caps/">https://appium.io/docs/en/writing-running-appium/caps/</a></p>

<p>For example, you need to make the following changes to <code class="highlighter-rouge">wdio.conf</code> to configure WebDriverIO to use Appium and run tests on Android Emulator:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exports.config = {
  specs: [
    './test/specs/**/*.js'
  ],
  exclude: [],
  maxInstances: 10,
<span class="gi">+ services: ['appium'],
+ port: 4723,
</span><span class="gd">- capabilities: [{
-    maxInstances: 5,
-    browserName: 'firefox'
-  }],
</span><span class="gi">+ capabilities: [{
+   maxInstances: 1,
+   browserName: '',
+   appiumVersion: '1.7.2',
+   platformName: 'Android',
+   platformVersion: '8.0',
+   deviceName: 'Android GoogleAPI Emulator',
+   app: '&lt;path to .apk file&gt;'
+ }],
</span>  sync: true,
  logLevel: 'verbose',
  coloredLogs: true,
  deprecationWarnings: true,
  bail: 0,
  screenshotPath: './errorShots/',
<span class="gd">- baseUrl: 'http://localhost',
</span>  waitforTimeout: 10000,
  connectionRetryTimeout: 90000,
  connectionRetryCount: 3,
  framework: 'jasmine',
  jasmineNodeOpts: {
    defaultTimeoutInterval: 10000,
    expectationResultHandler: function (passed, assertion) {
    }
  }
};
</code></pre></div></div>

<blockquote>
  <p>Note: If you are targeting iOS Device for running UI test, you would need a Mac machine with Xcode and command line tools installed. We automate the target devices my manipulating capabilities.</p>
</blockquote>

<p>In the above config, we added <code class="highlighter-rouge">appium</code> to the services list and updated the port to point to the Appium default port. Notice that we removed the <code class="highlighter-rouge">baseUrl</code> field as we don’t need it.</p>

<p>Capabilities have an <code class="highlighter-rouge">app</code> field value which should be set to the path of the <code class="highlighter-rouge">.apk</code> for Android or the <code class="highlighter-rouge">.app</code> for iOS application. The usual location for this file is <code class="highlighter-rouge">&lt;PROJECT_ROOT&gt;/android/app/build/outputs/apk/&lt;FILE_NAME.apk&gt;</code> for the <code class="highlighter-rouge">.apk</code> or <code class="highlighter-rouge">&lt;PROJECT_ROOT&gt;/ios/build/Build/Products/Debug-iphonesimulator/&lt;FILE_NAME.app&gt;</code> for the <code class="highlighter-rouge">.app</code> file.</p>

<p>We should also set <code class="highlighter-rouge">maxInstances</code> to 1 to avoid running multiple tests in parallel. This can alleviate the possibility of running out of memory.</p>

<p><strong>Step 3:</strong> Add a simple WebDriverIO UI test to run.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ./test/native/specs/simple-test.js</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">'My Simple test'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">'super test'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// For demo purpose</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Hey, I ran!'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Above is a dummy test block that installs and runs the app and then initiates the test and closes the application.</p>

<p><strong>Run the test:</strong>
For iOS and Android, make sure you have the required Xcode or Android Studio build tools set up to run React Native application. For Android use <a href="https://developer.android.com/studio/run/managing-avds">AVD Manager</a> to start the emulator before running the tests.</p>

<p>Run the UI test:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">wdio wdio.conf.js
</span></code></pre></div></div>

<p><img src="/engineering/assets/images/react-native-wdio/wdio-output.png" alt="Screenshot showing wdio output" /></p>

<p>Now, you have a WebdriverIO UI test running against the local emulator. You are now set to explore <a href="http://webdriver.io/api.html">WebDriverIO Mobile API</a> to continue writing more complete UI tests.</p>

<h2 id="running-tests-on-emulators-using-a-cloud-based-service-sauce-labs">Running tests on emulators using a cloud-based service: Sauce Labs</h2>

<p>WebDriverIO officially supports some of the popular cloud services like Sauce Labs and BrowserStack by providing a service plugin. Here at GoDaddy, we use <a href="https://saucelabs.com/">Sauce Labs</a> for performing mobile UI testing on emulators and real devices. If you don’t have a Sauce Labs account you can start a free trial here: <a href="https://signup.saucelabs.com/signup/trial?utm_campaign=free+trial&amp;utm_medium=blog&amp;utm_source=godaddy&amp;campid=7011M000001ELsB">Sauce Labs: Sign Up for a Free Trial</a></p>

<p>Let’s configure our current WebDriverIO test to run using the Sauce Labs emulators.</p>

<p><strong>Step 1:</strong> Install <a href="http://webdriver.io/guide/services/sauce.html">WDIO Sauce Service</a></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">npm install wdio-sauce-service --save-dev
</span></code></pre></div></div>

<p><strong>Step 2:</strong> Update the wdio.conf file.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- services: ['appium'],
</span><span class="gi">+ services: ['sauce'],
+ host: 'ondemand.saucelabs.com',
</span><span class="gd">- port: 4723,
</span><span class="gi">+ port: 80,
+ user: SAUCE_USERNAME,
+ key: SAUCE_ACCESS_KEY
</span></code></pre></div></div>

<p>Use <a href="https://wiki.saucelabs.com/display/DOCS/Platform+Configurator">Platform configurator by Sauce Labs</a> to update your capabilities if needed.</p>

<p><strong>Step 3:</strong> Upload your <code class="highlighter-rouge">.app</code> or <code class="highlighter-rouge">.apk</code> file to SauceStorage or any other accessible endpoint and then update your app path in capabilities to point to the remote storage location (as seen below). You can follow the documentation here; <a href="https://wiki.saucelabs.com/display/DOCS/Uploading+Mobile+Applications+to+Sauce+Storage+for+Testing">Uploading Mobile Applications to Sauce Storage for Testing</a> for more information around uploading your app to Sauce Labs.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- app: &lt;app path&gt;
</span><span class="gi">+ app: &lt;sauce-storage:myapp.zip or app link&gt;
</span></code></pre></div></div>

<p><strong>Run the test:</strong>
Let’s run the test using Sauce Labs with the updated configuration.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">wdio wdio.conf.js
</span></code></pre></div></div>

<p>Check the <a href="https://saucelabs.com/beta/dashboard/tests">Sauce Labs Dashboard</a> to make sure the test ran successfully. The WebDriverIO Sauce service automatically sets test labels and results. Now that you have run your test on cloud-based emulators, this opens up the ability to scale out the automation of your functional tests. Sometimes, an emulator doesn’t quite meet all the requirements necessary to ensure confidence in app quality due to lack of real sensors, older devices, and other aspects like memory and CPU of a real device.</p>

<h2 id="running-tests-on-real-devices-using-a-cloud-based-service">Running tests on real devices using a cloud-based service</h2>

<p>Sauce Labs also provides a real device testing solution through the TestObject platform. With some minor changes to the above <code class="highlighter-rouge">wdio.conf</code>, we can run UI tests on real devices.</p>

<p>First, create a project in the <a href="https://app.testobject.com/">TestObject dashboard</a> and upload your <code class="highlighter-rouge">.ipa</code> or <code class="highlighter-rouge">.apk</code> file.</p>

<p>There is no official WebDriverIO TestObject service and at the time of writing this blog, Sauce Labs and TestObject do not share the same API calls.</p>

<p><strong>Update <code class="highlighter-rouge">wdio.conf</code> file:</strong></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- services: ['sauce'],
</span><span class="gi">+ protocol: 'https',
+ host: 'us1.appium.testobject.com',
</span><span class="gd">- port: '80',
</span><span class="gi">+ port: '443',
+ path: '/api/appium/wd/hub',
</span>capabilities: {
  ...
<span class="gd">-  app: 'sauce-storage:myapp.zip'
</span><span class="gi">+  testobject_api_key: &lt;TESTOBJECT_ACCESS_KEY&gt;,
+  testobject_app_id: &lt;APP_ID&gt;,
</span>}
</code></pre></div></div>

<p>Refer to <a href="https://wiki.saucelabs.com/display/DOCS/Appium+Capabilities+for+Real+Device+Testing">Appium Capabilities for Real Device Testing</a> to update your capabilities if needed.</p>

<p><strong>Run the test:</strong>
Let’s run the test with the updated configuration.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">wdio wdio.conf
</span></code></pre></div></div>

<p>Check the <a href="https://app.testobject.com/">TestObject Dashboard</a> to make sure the test has run. WebDriverIO does not update test labels or results in TestObject Dashboard. TestObject does not aggregate the test results when running through WebDriverIO. Therefore, write some extra code to keep test results in sync. Here are some references that can help with that: <a href="https://github.com/pizzasaurusrex/TestObject">https://github.com/pizzasaurusrex/TestObject</a> or <a href="https://gist.github.com/rajapanidepu/0e8c0f89671a8a563a7463f8c1ff0413">https://gist.github.com/rajapanidepu/0e8c0f89671a8a563a7463f8c1ff0413</a></p>

<h2 id="making-test-results-consistent-and-predictable">Making test results consistent and predictable</h2>

<p>These functional tests are automated and work across multiple service and framework layers. These services and frameworks are not synchronous and not consistently responsive; therefore, we have to accommodate intermittent failures.</p>

<p>When we started to write the UI tests and run them as part of CICD, we observed that the tests were failing for reasons which were not related to the test code itself. An example of this was a test would pass in the first run, yet, we would see same test failing randomly in subsequent runs with no changes made to the test code.</p>

<p>There are various timeouts configurations in play here at each level of tech stack: WebDriverIO, Mocha/Jasmine, Appium, and Sauce Labs/TestObject.</p>

<p><strong>WebDriverIO timeouts:</strong></p>

<ul>
  <li><code class="highlighter-rouge">connectionRetryTimeout</code>: Http request timeouts while trying to connect to Appium server.</li>
  <li><code class="highlighter-rouge">waitforTimeout</code>: Timeout for all <code class="highlighter-rouge">waitFor</code> commands in the tests.</li>
</ul>

<p><strong>TestFramework timeout:</strong>
A test is declared as a failure if it isn’t completed within a certain time. Test frameworks and their respective timeout options are listed below.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Mocha</span>
<span class="nx">mochaOpts</span><span class="p">:</span> <span class="p">{</span>
  <span class="nx">timeout</span>
<span class="p">}</span>

<span class="c1">// Jasmine</span>
<span class="nl">jasmineNodeOpts</span><span class="p">:</span> <span class="p">{</span>
  <span class="nx">defaultTimeoutInterval</span>
<span class="p">}</span>

<span class="c1">// Cucumber</span>
<span class="nl">cucumberOpts</span><span class="p">:</span> <span class="p">{</span>
  <span class="nx">timeout</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Appium timeouts:</strong>
The following timeouts deal with how long Appium should wait for Android Virtual Device (AVD) emulator or iOS simulator to be ready and for the app to be installed.</p>

<ul>
  <li><code class="highlighter-rouge">appWaitDuration</code></li>
  <li><code class="highlighter-rouge">deviceReadyTimeout</code></li>
  <li><code class="highlighter-rouge">androidDeviceReadyTimeout</code> (Android only)</li>
  <li><code class="highlighter-rouge">androidInstallTimeout</code> (Android only)</li>
  <li><code class="highlighter-rouge">avdLaunchTimeout</code> (Android only)</li>
  <li><code class="highlighter-rouge">avdReadyTimeout</code> (Android only)</li>
  <li>
    <p><code class="highlighter-rouge">launchTimeout</code> (iOS only)</p>
  </li>
  <li><code class="highlighter-rouge">newCommandTimeout</code> - This limits how long (in seconds) Appium will wait for a new command from the client before assuming the client quit.</li>
</ul>

<p><strong>Sauce Labs/TestObject timeouts:</strong></p>

<ul>
  <li><code class="highlighter-rouge">commandTimeout</code>: Similar to Appium’s newCommandTimeout, but for Sauce Labs. How long Selenium can take to run a command.</li>
  <li><code class="highlighter-rouge">idleTimeout</code>: Limits how long a browser can wait for a test to send a new command.</li>
  <li><code class="highlighter-rouge">maxDuration</code>: A limit for the total time taken to run a test.</li>
</ul>

<p>In our case, simple WebDriverIO tests kept failing intermittently until we understood the timeouts and tweaked them. For example, we faced an issue where iOS tests running on Sauce Labs were taking a long time to allocate a simulator and install the application. Resulting in test failures with an error message: <code class="highlighter-rouge">Your test errored. Session did not start. User might have disconnected</code>. Bumping the default values of <code class="highlighter-rouge">idleTimeout</code> and <code class="highlighter-rouge">launchTimeout</code> from 90 seconds to 180 seconds fixed the issue. Your mileage may vary on the timeout values, but, we suggest experimenting with them to find the right values for your case if the defaults aren’t consistently working for you.</p>

<p>Occasionally, we did face few intermittent UI test failures due to the app being unresponsive after installation or network latency. We addressed this issue by adding retry logic on top of the WebDriverIO command to re-run the failed test suites. The retry mechanism we wrote involved aggregating failed tests and re-running them using a <a href="http://webdriver.io/v3.4/guide/testrunner/customreporter.html">custom reporter</a>. We observed that 95% of the time these failed tests pass on the second run increasing our overall success rate.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I hope the above discussion helps you set up some infrastructure for running WebDriverIO UI tests locally and remotely for emulators and real devices. We are continuing to write UI tests using WebDriverIO + Appium for native features which turned out to be quite effective for development teams while working with both web and native platforms.</p>

<p>GoDaddy is looking for full-stack engineers to join our mobile team. The team is building our next generation experiences for our small business customers to help them start, grow, and run their venture. If you have the passion, enthusiasm, and ability to create compelling interactions for customers on their way to making their small businesses great, we would like to talk to you! Apply here: <a href="https://careers.godaddy.com/">https://careers.godaddy.com/</a>.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="http://webdriver.io/api.html">WebDriverIO API</a></li>
  <li><a href="https://appium.io/docs/en/writing-running-appium/caps/">Appium Capabilities</a></li>
  <li><a href="https://github.com/pizzasaurusrex/TestObject">TestObject API wrapper</a></li>
</ul>

<p>Note: cover photo courtesy of <a href="http://webdriver.io/">http://webdriver.io/</a></p>


  <div class="text-center mb-1">
  <div class="addthis_inline_share_toolbox"></div>
</div>

  

<hr>

<div class="authors">
  <h4 class="mb-3">
  
  Authors
  
</h4>

  <div class="row">
    
    <div class="col-12 col-md-6">
      <div class="author mb-3">
        <a href="https://www.linkedin.com/in/rpanidepu/">
          <img class="rounded mr-2" src="/engineering/assets/images/rpanidepu.png" alt="Raja Panidepu" width="64">
          <span class="author-details">
            <h6>Raja Panidepu</h6>
            
          </span>
        </a>
      </div>
    </div>
    
    <div class="col-12 col-md-6">
      <div class="author mb-3">
        <a href="https://github.com/ineffably">
          <img class="rounded mr-2" src="https://avatars0.githubusercontent.com/u/1356998?s=150&v=4" alt="Chad Neff" width="64">
          <span class="author-details">
            <h6>Chad Neff</h6>
            
          </span>
        </a>
      </div>
    </div>
    
  </div>
</div>

</div>

<footer class="page-footer text-light bg-theme-grey-dark">
    <div class="container py-3">
      <div class="row">
        <div class="col-12 col-md-6">
          <h5 class="text-white text-font-headline">
            GoDaddy Engineering
          </h5>
          <p>
            At GoDaddy we build next-generation experiences that empower the world's small business owners to start and grow their independent ventures.

            <a href="https://careers.godaddy.com/?source=APPLICANT_SOURCE-3-118&utm_source=godaddy-oss" title="Work at GoDaddy">
              Join us!
            </a>
          </p>
        </div>
        <div class="col-12 col-md-4 offset-md-2">
          <h5 class="text-white text-font-headline">
            On the web
          </h5>
          <ul class="list-unstyled mb-0">
  
  
  <li>
    <a class="text-light" href="https://github.com/godaddy" title="godaddy on GitHub">
      GitHub
    </a>
  </li>
  
  
  
  <li>
    <a class="text-light" href="https://twitter.com/GodaddyOSS" title="GodaddyOSS on Twitter">
      Twitter
    </a>
  </li>
  
  
  
  <li>
    <a class="text-light" href="https://dribbble.com/GoDaddy" title="GoDaddy on Dribbble">
      Dribbble
    </a>
  </li>
  
  
  
  <li>
    <a class="text-light" href="https://www.facebook.com/GoDaddy" title="GoDaddy on Facebook">
      Facebook
    </a>
  </li>
  
  
</ul>

        </div>
      </div>
    </div>
    <div class="footer-copyright bg-extra-dark text-center text-light font-weight-light py-3">
      <small>
        Copyright © 1999 - 2018 GoDaddy Operating Company, LLC. All Rights Reserved.

      </small>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>


<script async src="https://www.google-analytics.com/analytics.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js"></script>
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-37178807-20', 'auto');
  ga('require', 'outboundLinkTracker');
  ga('send', 'pageview');
</script>



<script async src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b039a09ed801a5d"></script>






</body>
</html>

