<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Data pipeline job scheduling in GoDaddy: Developer’s point of view on Oozie vs Airflow — GoDaddy Engineering Blog</title>
  <meta name="description" content="Information from our engineering team about the technology and tools we use to create software which empowers small businesses around the world to build and market their digital identities.
">

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link rel="stylesheet" href="/engineering/assets/css/main.css">

  <meta name="theme-color" content="#4095e8">
  <meta name="msapplication-TileColor" content="#4095e8">
  <link rel="apple-touch-icon" sizes="180x180" href="/engineering/assets/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/engineering/assets/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/engineering/assets/images/favicon-16x16.png">
  <link rel="manifest" href="/engineering/site.webmanifest">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/engineering/feed.xml" title="GoDaddy Engineering Blog" />

  
  <link rel="canonical" href="http://localhost:4000/2018/11/15/developer-view-oozie-vs-airflow/">
  

  <meta property="og:locale" content="en_US">
  <meta property="og:site_name" content="GoDaddy Engineering Blog">
  <meta property="og:url" content="http://localhost:4000/2018/11/15/developer-view-oozie-vs-airflow/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@GodaddyOSS">

  
  <meta property="og:image" content="http://localhost:4000/assets/images/time.png">
  

  
  <meta property="og:title" content="Data pipeline job scheduling in GoDaddy: Developer’s point of view on Oozie vs Airflow — GoDaddy Engineering Blog">
  

  
  <meta property="og:description" content="This blog discusses the pros and cons of Oozie and Airflow to help you choose which scheduler to use for your data pipeline jobs. It also contains a sample plugin which implements the Airflow operator.">
  

  <link rel="preload" href="//img1.wsimg.com/ux/fonts/boing/1.0/Boing-Bold.woff2" as="font" type="font/woff2" crossOrigin />
  <style>
  @font-face {
    font-family: Boing-Bold;
    src: url(//img1.wsimg.com/ux/fonts/boing/1.0/Boing-Bold.woff2) format("woff2"), url(//img1.wsimg.com/ux/fonts/boing/1.0/Boing-Bold.woff) format("woff");
    font-display: swap;
  }
  </style>
  <link rel="preload" href="//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-bold.woff2" as="font" type="font/woff2" crossOrigin />
  <style>
  @font-face {
    font-family: gdsherpa;
    src: url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-bold.woff2) format("woff2"), url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-bold.woff) format("woff");
    font-weight: 700;
    font-display: swap;
  }
  </style>
  <link rel="preload" href="//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-regular.woff2" as="font" type="font/woff2" crossOrigin />
  <style>
  @font-face {
    font-family: gdsherpa;
    src: url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-regular.woff2) format("woff2"), url(//img1.wsimg.com/ux/fonts/sherpa/1.0/gdsherpa-regular.woff) format("woff");
    font-display: swap;
  }
  </style>
</head>

  <body class="layout--post page--developer-view-oozie-vs-airflow">
    <nav class="navbar utility-bar navbar-dark bg-theme-grey-dark px-3 py-0">
  <a class="navbar-brand pt-1 pb-0" href="https://www.godaddy.com">
    <svg class="logo-mark logo-mark-white" height="18" viewBox="0 0 367.7 78.1" xmlns="http://www.w3.org/2000/svg"><path class="logo-mark-color" d="M95.3 38.6c0-4.6-3.6-8.4-8.3-8.4-4.6 0-8.3 3.8-8.3 8.4s3.6 8.3 8.3 8.3 8.3-3.7 8.3-8.3m14.4.1c0 11.9-10.1 21.4-22.6 21.4-12.6 0-22.6-9.5-22.6-21.4 0-12 10.1-21.6 22.6-21.6 12.5-.1 22.6 9.6 22.6 21.6M154.8 30c0-8-5.6-15-13.9-15h-11.5v30.3h11.5c8.3 0 13.9-7.3 13.9-15.3m15.5 0c0 17.1-12.1 28.8-29.1 28.8h-24.6c-1.2 0-2.1-.9-2.1-2V3.4c0-1.1.9-2 2.1-2h24.6c17.1.1 29.1 11.5 29.1 28.6M194.4 46.9c4.6 0 8.3-3.8 8.3-8.4s-3.6-8.4-8.3-8.4c-4.6 0-8.3 3.8-8.3 8.4 0 4.7 3.7 8.4 8.3 8.4M192.2 17c4.9 0 8.8 1.8 10.5 4.3v-1.2c0-1.1.9-1.9 1.9-1.9H215c1.1 0 1.9.8 1.9 1.9v36.8c0 1.1-.8 1.9-1.9 1.9h-10.3c-1.1 0-1.9-.8-1.9-1.9v-1.2c-1.7 2.5-5.7 4.3-10.6 4.3-10.4 0-20.4-8.3-20.4-21.6s10-21.4 20.4-21.4M241.4 46.9c4.6 0 8.3-3.8 8.3-8.4s-3.6-8.4-8.3-8.4c-4.6 0-8.3 3.8-8.3 8.4 0 4.7 3.7 8.4 8.3 8.4M238.9 17c5 0 8.9 1.9 10.7 4.1V3.4c0-1.1.9-1.9 1.9-1.9H262c1.1 0 1.9.8 1.9 1.9V57c0 1.1-.8 1.9-1.9 1.9h-10.3c-1.1 0-1.9-.8-1.9-1.9v-1.2c-2.1 2.5-5.7 4.3-10.6 4.3-10.4 0-20.4-8.3-20.4-21.6S228.7 17 238.9 17M288.4 46.9c4.6 0 8.3-3.8 8.3-8.4s-3.6-8.4-8.3-8.4c-4.6 0-8.3 3.8-8.3 8.4.1 4.7 3.7 8.4 8.3 8.4M286 17c5 0 8.9 1.9 10.7 4.1V3.4c0-1.1.9-1.9 1.9-1.9H309c1.1 0 1.9.8 1.9 1.9V57c0 1.1-.8 1.9-1.9 1.9h-10.3c-1.1 0-1.9-.8-1.9-1.9v-1.2c-2.1 2.5-5.7 4.3-10.6 4.3-10.4 0-20.4-8.3-20.4-21.6S275.7 17 286 17M345.5 64.7c-2.6 8.6-8.6 13.4-18 13.4-5.1 0-10.1-1.7-13.3-4.5-.5-.5-.8-1.1-.8-1.7 0-.5.2-1.1.7-1.7l3.9-5.9c.6-.8 1.5-.9 1.7-.9.9 0 1.3.2 2.1.8 1.2.8 2.9 1.8 4.8 1.8 1.6 0 3.7-.7 4.5-3.1l1.3-4.1H326c-1.3 0-2.1-.9-2.5-2L313 21.5c-.2-.9-.3-1.4-.3-1.7 0-.8.6-1.5 1.7-1.5h12.4c1.1 0 1.7 1 2 2l6.9 25.4h.5l5.5-25.4c.2-1 .9-2 2-2h12.6c1.2 0 1.7.7 1.7 1.5 0 .3-.1.8-.3 1.7l-12.2 43.2M49.7 50.9c-5 6.9-13.2 9.2-20.5 9.2C12.4 60.1 0 47.6 0 30.2.1 13.5 13.5.2 31 .2c13 0 23.4 5.5 28.1 16 .6 1.2 1 3.2-2.5 3.8l-9.2 1.6c-2.1.4-3.3-1-3.7-1.6-2.7-3.7-7.1-6.2-12.4-6.2-9.2 0-15.7 7-15.7 16.3 0 10.3 7.4 16.3 15.5 16.3 5.4 0 9.8-2 12.7-5.8h-8.1c-1.2 0-2.1-.9-2.1-2v-7.7c0-1.1.9-2 2.1-2h24.7c1.2 0 2.1.9 2.1 2v25.9c0 1.1-.9 2-2.1 2h-8.6c-1.2 0-2.1-.9-2.1-2v-5.9M359.8 0c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14.4c-3.5 0-6.4-2.9-6.4-6.4s2.9-6.4 6.4-6.4 6.4 2.9 6.4 6.4-2.9 6.4-6.4 6.4z"></path><path class="logo-mark-color" d="M361.4 6.5c0-.4-.1-.7-.4-.8-.2-.2-.6-.4-.9-.4h-1.4v2.3h1.4c.4 0 .7-.1.9-.4.2-.2.4-.4.4-.7zm-3.1 5.9h-1.5c-.1 0-.1 0-.2-.1 0-.1-.1-.1-.1-.2V3.8c0-.1 0-.1.1-.2.1 0 .1-.1.2-.1h3.3c1.1 0 1.9.2 2.5.8s.9 1.3.9 2.1c0 .6-.1 1.1-.5 1.5-.4.5-.7.8-1.2 1.1l1.9 2.9c.1.1.1.2 0 .4 0 .1-.1.1-.2.1H362c-.1 0-.2 0-.4-.1-.1 0-.1-.1-.2-.2l-1.6-2.7h-1.2V12c0 .1 0 .1-.1.2s-.1.2-.2.2z"></path></svg>
    &nbsp;
  </a>
</nav>

<nav class="navbar navbar-top navbar-expand-md navbar-light bg-white">
  <a class="navbar-brand font-weight-bold" href="http://localhost:4000/engineering/" title="GoDaddy Engineering">
    GoDaddy Engineering
  </a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topnav" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="topnav">
    <ul class="navbar-nav ml-auto">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="http://localhost:4000/engineering/featured-projects/" title="Featured Projects">
          Featured Projects
        </a>
      </li>
      
      
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="http://localhost:4000/engineering/blog-posts/" title="Blog Posts">
          Blog Posts
        </a>
      </li>
      
      
      
      <li class="nav-item">
        <a class="nav-link font-weight-bold" href="http://localhost:4000/engineering/code-of-conduct/" title="Code of Conduct">
          Code of Conduct
        </a>
      </li>
      
      
      <li class="nav-item">
        <a class="nav-link btn btn-primary text-white font-weight-bold px-3" href="https://careers.godaddy.com/?source=APPLICANT_SOURCE-3-118&utm_source=godaddy-oss" title="Work at GoDaddy">
          Join us!
        </a>
      </li
    </ul>
  </div>
</nav>





<div class="container text-line-height-2x pt-3">
  <h1 class="mb-3 text-line-height-1-5-em">
    Data pipeline job scheduling in GoDaddy: Developer’s point of view on Oozie vs Airflow
  </h1>

  <p>On the Data Platform team at GoDaddy we use both Oozie and Airflow for scheduling jobs. 
In the past we’ve found each tool to be useful for managing data pipelines but are migrating all of our jobs to Airflow because of the reasons discussed below. 
In this article, I’ll give an overview of the pros and cons of using Oozie and Airflow to manage your data pipeline jobs.
To help you get started with pipeline scheduling tools I’ve included some sample plugin code to show how simple it is to modify or add functionality in Airflow.</p>

<h3 id="why-use-scheduling-tools-oozieairflow-over-cron">Why use scheduling tools (Oozie/Airflow) over Cron?</h3>

<p>These tools (Oozie/Airflow) have many built-in functionalities compared to Cron.</p>

<p>These are some of the scenarios for which built-in code is available in the tools but not in cron:</p>
<ul>
  <li>Automatically rerun jobs after failure.</li>
  <li>Add dependency checks; for example triggering a job if a file exists, or triggering one job after the completion of another.</li>
  <li>Trigger a job from a failure step.</li>
  <li>Cause the job to timeout when a dependency is not available.</li>
  <li>Add Service Level Agreement (SLA) to jobs.</li>
</ul>

<p>With cron, you have to write code for the above functionality, whereas Oozie and Airflow provide it.</p>

<h3 id="oozie">Oozie</h3>

<p><a href="https://github.com/apache/Oozie">Apache Oozie</a> is a workflow scheduler which uses Directed Acyclic Graphs (DAG) to schedule Map Reduce Jobs (e.g. Pig, Hive, Sqoop, Distcp, Java functions). 
It’s an open source project written in Java.
When we develop Oozie jobs, we write bundle, coordinator, workflow, properties file. A workflow file is required whereas others are optional.</p>
<ul>
  <li>The workflow file contains the actions needed to complete the job. Some of the common actions we use in our team are the Hive action to run hive scripts, ssh action, shell action, pig action and fs action for creating, moving, and removing files/folders</li>
  <li>The coordinator file is used for dependency checks to execute the workflow.</li>
  <li>The bundle file is used to launch multiple coordinators.</li>
  <li>The properties file contains configuration parameters like start date, end date and metastore configuration information for the job.</li>
</ul>

<p>At GoDaddy, we use Hue UI for monitoring Oozie jobs.</p>

<ul>
  <li>Pros:
    <ul>
      <li>Uses XML, which is easy to learn</li>
      <li>Doesn’t require learning a programming language</li>
      <li>Retry on failure is available</li>
      <li>Alerts on failure</li>
      <li>SLA checks can be added</li>
    </ul>
  </li>
  <li>Cons:
    <ul>
      <li>Less flexibility with actions and dependency, for example: Dependency check for partitions should be in MM, dd, YY format, if you have integer partitions in M or d, it’ll not work.</li>
      <li>Actions are limited to allowed actions in Oozie like fs action, pig action, hive action, ssh action and shell action.</li>
      <li>All the code should be on HDFS for map reduce jobs.</li>
      <li>Limited amount of data (2KB) can be passed from one action to another.</li>
      <li>Supports time-based triggers but does not support event-based triggers. Can not automatically trigger dependent jobs. For example, if job B is dependent on job A, job B doesn’t get triggered automatically when job A completes. The workaround is to trigger both jobs at the same time, and after completion of job A, write a success flag to a directory which is added as a dependency in coordinator for job B. You must also make sure job B has a large enough timeout to prevent it from being aborted before it runs.</li>
    </ul>
  </li>
</ul>

<h3 id="airflow">Airflow</h3>

<p><a href="https://github.com/apache/incubator-airflow">Apache Airflow</a> is another workflow scheduler which also uses DAGs.
It’s an open source project written in python.
Some of the features in Airflow are:</p>
<ul>
  <li>Operators, which are job tasks similar to actions in Oozie.</li>
  <li>Hooks to connect to various databases.</li>
  <li>Sensors to check if a dependency exists, for example: If your job needs to trigger when a file exists then you have to use sensor which polls for the file.</li>
</ul>

<p>At GoDaddy, Customer Knowledge Platform team is working on creating docker for Airflow, so other teams can develop and maintain their own Airflow scheduler.</p>

<ul>
  <li>Pros:
    <ul>
      <li>The Airflow UI is much better than Hue (Oozie UI),for example: Airflow UI has a Tree view to track task failures unlike Hue, which tracks only job failure.</li>
      <li>The Airflow UI also lets you view your workflow code, which the Hue UI does not.</li>
      <li>More flexibility in the code, you can write your own operator plugins and import them in the job.</li>
      <li>Allows dynamic pipeline generation which means you could write code that instantiates a pipeline dynamically.</li>
      <li>Contains both event-based trigger and time-based trigger. 
  Event based trigger is so easy to add in Airflow unlike Oozie. 
  Event based trigger is particularly useful with data quality checks. 
  Suppose you have a job to insert records into database but you want to verify whether an insert operation is successful so you would write a query to check record count is not zero. 
  In Airflow, you could add a data quality operator to run after insert is complete where as in Oozie, since it’s time based, you could only specify time to trigger data quality job.</li>
      <li>Lots of functionalities like retry, SLA checks, Slack notifications, all the functionalities in Oozie and more.</li>
      <li>Disable jobs easily with an on/off button in WebUI whereas in Oozie you have to remember the jobid to pause or kill the job.</li>
    </ul>
  </li>
  <li>Cons:
    <ul>
      <li>In 2018, Airflow code is still an incubator. There is large community working on the code.</li>
      <li>Manually delete the filename from meta information if you change the filename.</li>
      <li>You need to learn python programming language for scheduling jobs. 
  For Business analysts who don’t have coding experience might find it hard to pick up writing Airflow jobs but once you get hang of it, it becomes easy.</li>
      <li>When concurrency of the jobs increases, no new jobs will be scheduled. 
  Sometimes even though job is running, tasks are not running , this is due to number of jobs running at a time can affect new jobs scheduled. 
  This also causes confusion with Airflow UI because although your job is in run state, tasks are not in run state.</li>
    </ul>
  </li>
</ul>

<h3 id="what-works-for-your-organization-oozie-or-airflow">What works for your Organization? (Oozie or Airflow)</h3>

<p>Airflow has so many advantages and there are many companies moving to Airflow. 
There is an active community working on enhancements and bug fixes for Airflow.
A few things to remember when moving to Airflow:</p>
<ul>
  <li>You have to take care of scalability using Celery/Mesos/Dask.</li>
  <li>You have to take care of file storage. When we download files to Airflow box we store in mount location on hadoop.</li>
</ul>

<p>We are using Airflow jobs for file transfer between filesystems, data transfer between databases, ETL jobs etc.
We plan to move existing jobs on Oozie to Airflow.</p>

<h5 id="sample-airflow-plugin">Sample Airflow plugin</h5>

<p>Unlike Oozie you can add new funtionality in Airflow easily if you know python programming.
Below I’ve written an example plugin that checks if a file exists on a remote server, and which could be used as an operator in an Airflow job.
Airflow polls for this file and if the file exists then sends the file name to next task using xcom_push().
We often append data file names with the date so here I’ve used glob() to check for a file pattern.</p>

<p>This python file is added to plugins folder in Airflow home directory:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">from</span> <span class="nn">Airflow.plugins_manager</span> <span class="kn">import</span> <span class="n">AirflowPlugin</span>
<span class="kn">from</span> <span class="nn">Airflow.utils.decorators</span> <span class="kn">import</span> <span class="n">apply_defaults</span>
<span class="kn">from</span> <span class="nn">Airflow.operators.sensors</span> <span class="kn">import</span> <span class="n">BaseSensorOperator</span>


<span class="k">class</span> <span class="nc">FileSensorOperator</span><span class="p">(</span><span class="n">BaseSensorOperator</span><span class="p">):</span>
    <span class="nd">@apply_defaults</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FileSensorOperator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_pattern</span> <span class="o">=</span> <span class="n">file_pattern</span>
    
    <span class="c"># poke is standard method used in built-in operators</span>
    <span class="k">def</span> <span class="nf">poke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">file_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span>
        <span class="n">file_name</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_pattern</span>

        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_location</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
                <span class="n">context</span><span class="p">[</span><span class="s">'task_instance'</span><span class="p">]</span><span class="o">.</span><span class="n">xcom_push</span><span class="p">(</span><span class="s">'file_name'</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'file exists'</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'file not exists'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">FilePlugin</span><span class="p">(</span><span class="n">AirflowPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'file_plugin'</span>
    <span class="n">operators</span> <span class="o">=</span> <span class="p">[</span><span class="n">FileSensorOperator</span><span class="p">]</span>
</code></pre></div></div>

<h6 id="airflow-dag">Airflow DAG</h6>

<p>The below code uses an Airflow DAGs (Directed Acyclic Graph) to demonstrate how we call the sample plugin implemented above. 
In this code the default arguments include details about the time interval, start date, and number of retries. 
You can add additional arguments to configure the DAG to send email on failure, for example.</p>

<p>The DAG is divided into 3 tasks.</p>
<ul>
  <li>The first task is to call the sample plugin which checks for the file pattern in the path every 5 seconds and get the exact file name.</li>
  <li>The second task is to write to the file.</li>
  <li>The third task is to archive the file.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">Airflow.models</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">Airflow</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">Airflow.operators</span> <span class="kn">import</span> <span class="n">PythonOperator</span><span class="p">,</span> <span class="n">ArchiveFileOperator</span>
<span class="kn">from</span> <span class="nn">Airflow.operators.file_plugin</span> <span class="kn">import</span> <span class="n">FileSensorOperator</span>


<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'owner'</span><span class="p">:</span> <span class="s">'dag_developer'</span><span class="p">,</span>
    <span class="s">'start_date'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="s">'provide_context'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="s">'retries'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">'retry_delay'</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="s">'max_active_runs'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">'schedule_interval'</span><span class="p">:</span> <span class="s">'30 18 * * *'</span><span class="p">,</span> <span class="c">#run everyday at 6:30 PM</span>
<span class="p">}</span>

<span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="s">'check_file_and_write_to_file'</span><span class="p">,</span> <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">)</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="n">Variable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'source_path'</span><span class="p">)</span>
<span class="n">file_pattern</span> <span class="o">=</span> <span class="n">Variable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'file_pattern'</span><span class="p">)</span>
<span class="n">archive_path</span> <span class="o">=</span> <span class="n">Variable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'archive_path'</span><span class="p">)</span>

<span class="c"># Check fo the file pattern in the path, every 5 seconds. Send the exact file name to the next task(process_task)</span>
<span class="n">sensor_task</span> <span class="o">=</span> <span class="n">FileSensorOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="s">'file_sensor'</span><span class="p">,</span>
    <span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
    <span class="n">filepattern</span><span class="o">=</span><span class="n">file_pattern</span><span class="p">,</span>
    <span class="n">poke_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">)</span>

<span class="c"># Read the file name from the previous task(sensor_task). Write "Fun scheduling with Airflow" to the file</span>
<span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s">'task_instance'</span><span class="p">]</span><span class="o">.</span><span class="n">xcom_pull</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s">'file_name'</span><span class="p">,</span> <span class="n">task_ids</span><span class="o">=</span><span class="s">'file_sensor'</span><span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'Fun scheduling with Airflow'</span><span class="p">)</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Call python function which writes to file</span>
<span class="n">proccess_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="s">'process_the_file'</span><span class="p">,</span> 
    <span class="n">python_callable</span><span class="o">=</span><span class="n">process_file</span><span class="p">,</span>
    <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">)</span>

<span class="c"># Archive file once write to file is complete</span>
<span class="n">archive_task</span> <span class="o">=</span> <span class="n">ArchiveFileOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="s">'archive_file'</span><span class="p">,</span>
    <span class="n">filepath</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
    <span class="n">archivepath</span><span class="o">=</span><span class="n">archive_path</span><span class="p">,</span>
    <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">)</span>
    
<span class="c"># This line tells the sequence of tasks called</span>
<span class="n">sensor_task</span> <span class="o">&gt;&gt;</span> <span class="n">proccess_task</span> <span class="o">&gt;&gt;</span> <span class="n">archive_task</span>  <span class="c"># "&gt;&gt;" is airflow operator used to indicate sequence of the workflow </span>
</code></pre></div></div>

<p>Our team has written similar plugins for data quality checks. Unlike Oozie, Airflow code allows code flexibility for tasks which makes development easy. If you’re thinking about scaling your data pipeline jobs I’d recommend Airflow as a great place to get started.</p>

<p>Photo credit: <a href="https://www.flickr.com/photos/smemon/4961717384/in/photolist-8ys6Hs-8bHwZj-HMknRa-cALCvQ-biWKFi-SKekjx-9Cktks-WawY9F-27FxXxM-sbHMwc-6SUnx7-CdHNYT-HkyPUL-egY3ua-d3b4-qfFXBw-dPsJcG-n96Eb8-2aCmV45-9b5fnh-5r97iL-7xcstJ-dqTdUV-LYBzzN-bYY96-b3auhB-pEoeBm-8PLsEH-tEiSH-bEhhhM-HtVJ9U-7M65Ep-jFXZkr-bCM8hm-4H3vzx-bqNWr3-X9Sqi6-WX3EMe-4F4Yhq-9X4LVF-e3aNV2-8ZPjix-frLwC-s3MCyZ-21UgJD3-fa2HL6-s65ay3-MZkYN7-c1Cex7-9TKJ8s">‘Time‘</a> by <a href="https://www.flickr.com/photos/smemon/">Sean MacEntee</a> on <a href="https://www.flickr.com/photos">Flickr</a></p>


  <div class="text-center mb-1">
  <div class="addthis_inline_share_toolbox"></div>
</div>

  

<hr>

<div class="authors">
  <h4 class="mb-3">
  
  Author
  
</h4>

  <div class="row">
    
    <div class="col-12">
      <div class="author mb-3">
        <a href="https://www.linkedin.com/in/anushabuchireddygari/">
          <img class="rounded mr-2" src="/engineering/assets/images/anusha-buchireddygari.png" alt="Anusha Buchireddygari" width="64">
          <span class="author-details">
            <h6>Anusha Buchireddygari</h6>
            
          </span>
        </a>
      </div>
    </div>
    
  </div>
</div>

</div>

<footer class="page-footer text-light bg-theme-grey-dark">
    <div class="container py-3">
      <div class="row">
        <div class="col-12 col-md-6">
          <h5 class="text-white text-font-headline">
            GoDaddy Engineering
          </h5>
          <p>
            At GoDaddy we build next-generation experiences that empower the world's small business owners to start and grow their independent ventures.

            <a href="https://careers.godaddy.com/?source=APPLICANT_SOURCE-3-118&utm_source=godaddy-oss" title="Work at GoDaddy">
              Join us!
            </a>
          </p>
        </div>
        <div class="col-12 col-md-4 offset-md-2">
          <h5 class="text-white text-font-headline">
            On the web
          </h5>
          <ul class="list-unstyled mb-0">
  
  
  <li>
    <a class="text-light" href="https://github.com/godaddy" title="godaddy on GitHub">
      GitHub
    </a>
  </li>
  
  
  
  <li>
    <a class="text-light" href="https://twitter.com/GodaddyOSS" title="GodaddyOSS on Twitter">
      Twitter
    </a>
  </li>
  
  
  
  <li>
    <a class="text-light" href="https://dribbble.com/GoDaddy" title="GoDaddy on Dribbble">
      Dribbble
    </a>
  </li>
  
  
  
  <li>
    <a class="text-light" href="https://www.facebook.com/GoDaddy" title="GoDaddy on Facebook">
      Facebook
    </a>
  </li>
  
  
</ul>

        </div>
      </div>
    </div>
    <div class="footer-copyright bg-extra-dark text-center text-light font-weight-light py-3">
      <small>
        Copyright © 1999 - 2018 GoDaddy Operating Company, LLC. All Rights Reserved.

      </small>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>


<script async src="https://www.google-analytics.com/analytics.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js"></script>
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-37178807-20', 'auto');
  ga('require', 'outboundLinkTracker');
  ga('send', 'pageview');
</script>



<script async src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b039a09ed801a5d"></script>






</body>
</html>

